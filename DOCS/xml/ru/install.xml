<?xml version="1.0" encoding="KOI8-R"?>
<!-- synced with r19779 -->
<chapter id="install">
<title>Установка</title>

<para>
В файле <filename>README</filename> вы сможете найти короткое руководство
по установке. Пожалуйста, сначала прочтите его, а затем вернитесь к оставшимся
неясными деталям.
</para>

<para>
В этой главе я постараюсь провести Вас через процесс компиляции и конфигурации
<application>MPlayer</application>'а. Это не просто, но это не обязательно будет сложно. Если Вы заметите
какие-то отклонения, от того, что я объясняю, пожалуйста, поищите в этой
документации и Вы найдёте ответ. Если Вы увидите ссылку, пожалуйста, проследуйте
по ней и внимательно прочитайте её содержимое. Это займёт некоторое время,
но это ДЕЙСТВИТЕЛЬНО того стоит
</para>

<para>
Вам нужна современная система. Под Linux'ом рекомендуются ядра 2.4.x.
</para>


<sect1 id="softreq">
<title>Требуемые программы:</title>

<itemizedlist>
<listitem><para>
  <emphasis role="bold">binutils</emphasis> - рекомендуемая версия - это
  <emphasis role="bold">2.11.x</emphasis> . Эта программа ответственна за
  генерацию MMX/3DNow!/и т. п. инструкций, и поэтому очень важна.
  </para></listitem>
<listitem><para>
  <emphasis role="bold">gcc</emphasis> - рекомендуемые версии:
  <emphasis role="bold">2.95.3</emphasis> (может быть <emphasis role="bold">2.95.4</emphasis>)
и <emphasis role="bold">3.2+</emphasis>.
<emphasis role="bold">НИКОГДА</emphasis> не используйте 2.96 или 3.0.x! Они генерируют ошибочный код 
для <application>MPlayer'а</application>. Если Вы решите изменить gcc с версии 2.96, то не принимайте решение
в направлении 3.x только поскольку он новее. Ранние релизы 3.x содержали ещё
больше ошибок, чем 2.96. Так что ставьте 2.95.x (поставьте также более старую
libstdc++, это может потребоваться для других программ) или вообще ничего
не меняйте (но в этом случае приготовьтесь к проблемам во время работы).
Если Вы решите использовать 3.x, попробуйте использовать последнюю версию,
в ранних релизах были различные ошибки/проблемы, так что используйте минимум 3.1, это
протестированно и работает. 
  </para></listitem>
<listitem><para>
  <emphasis role="bold">XFree86</emphasis> - рекомендуемая версия - это <emphasis role="bold">всегда новейшая (4.3)</emphasis>.
Обычно, все этого хотят, поскольку начиная с 4.0.2, XFree86 содержат
<link linkend="xv">XVideo</link> расширение (иногда упоминаемое, как
<emphasis role="bold">Xv</emphasis>) которое требуется для включения аппаратной YUV акселерации (быстрый
вывод изображений на видеокартах, которые это поддерживают.</para>
  <para>
Будьте уверены, что <emphasis role="bold">пакет разработки</emphasis> также установлен, иначе это
не будет работать.</para>
  <para>
Для некоторых видео карт, вам не нужен XFree86. Их список см. ниже.
  </para></listitem>
<listitem><para>
  <emphasis role="bold">make</emphasis> - рекомендуемая версия - это <emphasis role="bold">всегда новейшая</emphasis> (минимум
3.79.x). Обычно это не очень важно.
  </para></listitem>
<listitem><para>
  <emphasis role="bold">SDL</emphasis> - это не обязательно, но может помочь в некоторых случаях
(плохие аудио, видео карты, которые странно лагуют с xv драйвером).
Всегда используйте новейшую версию (начиная с 1.2.x).
  </para></listitem>
<listitem><para>
  <emphasis role="bold">libjpeg</emphasis> - необязательный декодер JPEG,
  используемый -mf и некоторыми QT MOV файлами. Полезен для
  <application>MPlayer</application>'а и <application>MEncoder</application>'а,
  если Вы планируете работать с jpeg файлами.
  </para></listitem>
<listitem><para>
  <emphasis role="bold">libpng</emphasis> - рекомендуемый и используемый
  по умолчанию (M)PNG декодер. Необходим для GUI.Полезен как для
  <application>MPlayer'а</application>, так и для <application>MEncoder'а</application>.
  </para></listitem>
<listitem><para>
  <emphasis role="bold">lame</emphasis> - рекомендуется, необходимо для кодирования MP3 аудио c MEncoder,
рекомендуемая версия - это <emphasis role="bold"> всегда новейшая</emphasis> (как минимум 3.90).
  </para></listitem>
<listitem><para>
  <emphasis role="bold">zlib</emphasis> - рекомендуется, необходима для сжатых
  MOV заголовков и поддержки PNG.
  </para></listitem>
<listitem><para>
  <emphasis role="bold">libogg</emphasis> - необязательно, необходимо для проигрывания файлов формата OGG.
  </para></listitem>
<listitem><para>
  <emphasis role="bold">libvorbis</emphasis> - необязательно, необходимо для проигрывания OGG Vorbis аудио.
  </para></listitem>
<listitem><para>
  <emphasis role="bold"><ulink url="http://www.live555.com/mplayer/">LIVE555 Streaming Media</ulink></emphasis>
- необязательно, необходимо для проигрывания RTSP/RTP потоков.
  </para></listitem>
<listitem><para>
  <emphasis role="bold">directfb</emphasis> - необязательно, на
<ulink url="http://www.directfb.org">http://www.directfb.org</ulink>. 
Требуется минимум 0.9.13.
  </para></listitem>
<listitem><para>
  <emphasis role="bold">cdparanoia</emphasis> - необязательно, для поддержки CDDA
  </para></listitem>
<listitem><para>
  <emphasis role="bold">libfreetype</emphasis> - необязательно, для поддержки TTF шрифтов.
Требуется минимум 2.0.9.
  </para></listitem>
<listitem><para>
  <emphasis role="bold">libxmms</emphasis> - необязательно, для поддержки входных плагинов XMMS.
Требуется минимум 1.2.7.
  </para></listitem>
<listitem><para>
  <emphasis role="bold">libsmb</emphasis> - необязательно, для поддержки Samba.
  </para></listitem>
<listitem><para>
 <emphasis role="bold">ALSA</emphasis> - необязательно, для поддержки вывода звука через ALSA
Требуется минимум  0.9.0rc4.
  </para></listitem>
<listitem><para>
  <emphasis role="bold">bio2jack</emphasis> - необязательно, для поддержки
  вывода звука через JACK, требуется только при компиляции. Вы можете получить
  это с <ulink url="http://bio2jack.sf.net/">http://bio2jack.sf.net</ulink>.
  Поскольку там нет возможности установить библиотеку, Вы должны вручную
  скопировать файл <filename>libbio2jack.a</filename> куда-нибудь в Ваш
  библиотечный путь (e.g. <filename>/usr/local/lib</filename>) или используйте
  опцию <option>--with-bio2jack=DIR</option>, чтобы указать
  <filename>./configure</filename> где искать этот файл.
  </para></listitem>
</itemizedlist>
</sect1>


<sect1 id="installation_codecs">
<title>Кодеки:</title>

<itemizedlist>
<listitem><para>
  <emphasis role="bold"><systemitem class="library">libavcodec</systemitem></emphasis>:
  Этот пакет кодеков способен декодировать 
  H263/MJPEG/RV10/DivX3/DivX4/DivX5/MP41/MP42/WMV1/WMV2/SVQ1/SVQ3-кодированные видео потоки и
  WMA (Windows Media Audio) v1/v2 аудио потоки, на многих платформах.
  Он также известен как быстрейший кодек для этих задач.
  Подробности см. в разделе <link linkend="ffmpeg">FFmpeg</link>. Особенности:
  <itemizedlist>
  <listitem><simpara>
    декодирование упомянутых выше видеокодеков на не-x86 платформах
	</simpara></listitem>
  <listitem><simpara>
    кодирование большинством упомянутых кодеков
	</simpara></listitem>
  <listitem><simpara>
    этот кодек - это <emphasis role="bold">быстрейший доступный кодек</emphasis>
	для DivX/3/4/5 и прочих типов MPEG4. Рекомендуется!
  </simpara></listitem>
</itemizedlist>
</para></listitem>
<listitem><para>
  <emphasis role="bold">Win32 кодеки</emphasis>: Если Вы планируете использовать MPlayer на x86 архитектуре,
они вам вероятно потребуются. Скачайте Win32 кодеки с нашей 
<ulink url="http://www.mplayerhq.hu/design7/codecs.html">страницы кодеков</ulink>
и установите их в <filename class="directory">/usr/local/lib/codecs</filename> <emphasis role="bold">ДО</emphasis> компиляции <application>MPlayer'а</application>,
иначе поддержка Win32 будет отключена!
<note><para>У проекта avifile похожий набор кодеков, но он отличается от нашего,
  поэтому, если Вы хотите использовать все поддерживаемые кодеки, тогда поставьте наш
  пакет (не беспокойтесь, avifile работает с ними без проблем).</para>
  </note>
Особенности:
<itemizedlist>
<listitem><simpara>
  Вам это понадобится, если Вы хотите проигрывать, например, фильмы,
записанные с различных аппаратных компрессоров, таких, как тюнеры,
	цифровые камеры (например: DV, ATI VCR, MJPEG)
  </simpara></listitem>
<listitem><simpara>
  необходимо, если Вы хотите проигрывать <emphasis role="bold">WMV9/WMA9 фильмы</emphasis>.
  </simpara></listitem>
<listitem><simpara>
  Не нужно для старых ASF'ок с MP41 или MP42 видео (хотя в этих файлах часто
встречается VoxWare аудио - декодируется Win32 кодеками), или WMV7. Также
	не нужно для WMA (Windows Media Audio), в
	<systemitem class="library">libavcodec</systemitem>
	для этого есть декодер с открытыми исходниками.
  </simpara></listitem>
</itemizedlist>
</para></listitem>
<listitem><para>
  <emphasis role="bold">QuickTime кодеки</emphasis>: на x86 платформах эти кодеки могут использоваться
для декодирования RPZA, и прочих QuickTime'овских видео, и
QDesign аудио потоков. Инструкции по установке могут быть найдены в секции
<link linkend="sorenson">Sorenson видео кодек</link>.
  </para></listitem>

<listitem><para>
  <emphasis role="bold">XviD</emphasis>: кодирующая альтернатива
  для DivX4Linux с открытым исходным кодом. Особенности:
<itemizedlist>
<listitem><simpara>
  кодирование в 1 или 2 прохода
  <link linkend="mencoder"><application>MEncoder</application>'ом</link>
  </simpara></listitem>
<listitem><simpara>
  его исходный код открыт, поэтому он многоплатформенен.
  </simpara></listitem>
<listitem><simpara>
  он где-то раза в 2 быстрее, чем DivX4 при кодировании, при примерно таком же
качестве
  </simpara></listitem>
</itemizedlist>
</para></listitem>
<listitem><para>
  <emphasis role="bold"><link linkend="xanim">XAnim'овские кодеки</link></emphasis> - лучшие (полный экран,
аппаратное YUV масштабирование) для декодирования <emphasis role="bold">3ivx</emphasis>, Indeo 3/4/5 фильмов,
и некоторых старых форматов. И они многоплатформенные, поэтому это единственный
способ проигрывать Indeo на не-x86 платформах (ну, кроме как использовать
Xanim:). Но, к примеру, Cinepak фильмы лучше проигрываются с оригинальным
<application>MPlayer</application>'овским декодером!
  </para></listitem>
<listitem><para>
  Для декодирования <emphasis role="bold">Ogg Vorbis</emphasis> аудио, Вам нужно правильно установить
<systemitem class="library">libvorbis</systemitem>. 
  Скачать бинарные пакеты и исходный код можно с 
  <ulink url="http://www.vorbis.com/download.psp">сайта Ogg Vorbis</ulink>.
  </para></listitem>
<listitem><para>
  <application>MPlayer</application> может использовать библиотеки из RealPlayer 8 или RealONE, чтобы
проигрывать файлы с <emphasis role="bold">RealVideo 3.0 и 4.0</emphasis> видео, и Sipro/Cook аудио. См.
секцию <link linkend="realmedia">формат файлов RealMedia</link> для инструкций по установке
и дополнительной информации.
  </para></listitem>
</itemizedlist>
</sect1>


<sect1 id="video-cards">
<title>Видео карты</title>

<para>
В целом, существуют два типа видео карт. Первый тип (новейшие карты) поддерживают
<emphasis role="bold">аппаратное масштабирование и YUV акселерацию</emphasis>, другие карты - нет.
</para>

<sect2 id="yuv-cards">
<title>YUV карты</title>

<para>
Они могут показывать и масштабировать изображение до любого размера, помещающегося
в их память, с <emphasis role="bold">малой загрузкой CPU</emphasis> (даже при масштабировании), поэтому
полноэкранный просмотр приятный и очень быстрый.

<itemizedlist>
<listitem><para>
  <emphasis role="bold">Matrox G200/G400/G450/G550 карты</emphasis>: хотя
<link linkend="vidix">Vidix драйвер</link> и существует, вместо него рекомендуется
использовать модуль ядра mga_vid, поскольку он лучше работает. Пожалуйста,
прочтите секцию <link linkend="mga_vid">mga_vid</link> о его установке и
использовании. Важно проделать эти операции <emphasis>до</emphasis> компиляции <application>MPlayer'а</application>,
иначе поддержка mga_vid не будет собрана. Также обратите внимание на секцию
<link linkend="tvout-mga-g400">Matrox TV-вывод</link>.
<emphasis role="bold">Если Вы не используете Linux</emphasis>, Ваша единственная возможность -
использовать VIDIX драйвер: см. секцию <link linkend="vidix">VIDIX</link>.
  </para></listitem>
<listitem><para>
  <emphasis role="bold">3Dfx Voodoo3/Banshee карты</emphasis>: читайте секцию
<link linkend="tdfxfb">tdfxfb</link>, чтобы получить значительное ускорение.
Важно проделать эти операции <emphasis>до</emphasis> компиляции MPlayer'а, иначе поддержка
mga_vid не будет собрана. Если Вы используете X,
используйте <emphasis role="bold">минимум 4.2.0</emphasis>, поскольку 3dfx Xv драйвер был сломан в 4.1.0
и более ранних версиях.
  </para></listitem>
<listitem><para>
  <emphasis role="bold">ATI карты</emphasis>: существует <link linkend="vidix">VIDIX</link> драйвер
для следующих карт: <emphasis role="bold">Radeon, Rage128, Mach64</emphasis>
(Rage XL/Mobility, Xpert98).Также см. секцию <link linkend="tvout-ati">
ATI карт</link> в документации TV-вывода, чтобы узнать, поддерживается ли TV-out
Вашей карты под Linux/<application>MPlayer</application>.
  </para></listitem>
<listitem><para>
  <emphasis role="bold">S3 карты</emphasis>: у Savage и Virge/DX чипов есть аппаратная акселерация.
Используйте наиболее свежую версию XFree86, старые драйвера содержат ошибки.
У Savage чипов проблемы с выводом YV12, см. <link linkend="s3">S3 Xv</link>
секцию для подробностей. У более старых Trio карт нет аппаратной поддержки,
или она медленная.
  </para></listitem>
<listitem><para>
  <emphasis role="bold">nVidia карты</emphasis>: может быть, а может и не быть хорошим выбором для просмотра
фильмов. Если у Вас не GeForce2 (или более новая) карта, то маловероятно, что
она будет работать без ошибок.
<emphasis role="bold">Встроенные nVidia драйвера в XFree86 не поддерживают YUV акселерацию на всех
nVidia картах.</emphasis> Вам необходимо скачать драйверы с закрытым исходным кодом
с <ulink url="http://nvidia.com">nVidia.com</ulink>. См. секцию <link linkend="nvidia">nVidia Xv драйвера</link>
для подробностей. Также посмотрите секцию <link linkend="tvout-nvidia">
nVidia TV-выход</link>, если Вы хотите использовать TV.
  </para></listitem>
<listitem><para>
  <emphasis role="bold">3DLabs GLINT R3 и Permedia3</emphasis>: существует VIDIX драйвер (pm3_vid).
Для подробностей, см. секцию <link linkend="vidix">VIDIX</link>.
  </para></listitem>
<listitem><para>
  <emphasis role="bold">Другие карты</emphasis>: Не упомянута выше?
<itemizedlist>
<listitem><simpara>
  Проверьте, поддерживает ли XFree86 драйвер (и Ваша карта) аппаратную
акселерацию. Подробности см. в секции <link linkend="xv">Xv</link>.
  </simpara></listitem>
<listitem><simpara>
  Если нет, то возможности Вашей видеокарты не поддерживаются под Вашей
операционной системой :(
    Если аппаратная акселерация работает под Windows, это не значит, что
	она будет работать под Linux или иной операционной системой: это зависит
	от драйвера. Большинство производителей не делают Linux'овых драйверов
	и не распространяют спецификации для их чипов, поэтому Вам не повезло,
	что Вы используете их карты. См. <xref linkend="non-yuv-cards"/>.
  </simpara></listitem>
</itemizedlist>
</para></listitem>
</itemizedlist>
</para>

</sect2>


<sect2 id="non-yuv-cards" xreflabel="Не-YUV карты">
<title>Не-YUV карты</title>

<para>
Полноэкранное воспроизведение может быть достигнуто либо включением <emphasis role="bold">программного
масштабирования</emphasis> (используйте <option>-zoom</option> или <option>-vf scale</option>
опции, но я предупреждаю Вас: это медленно), или переключением в видео режим
с меньшим разрешением, например 352x288. Если у Вас нет аппаратной YUV акселерации,
этот метод предпочтителен. Изменение видео режима может быть включено использованием
опции <option>-vm</option> и работает со следующими драйверами:
<itemizedlist>
<listitem><simpara>
  <emphasis role="bold">используя</emphasis> XFree86: подробности см. в секциях
<link linkend="dga">DGA драйвер</link> и
<link linkend="x11">X11 драйвер</link>. Рекомендуется DGA !
Также попробуйте использовать DGA через SDL, иногда это лучше.
  </simpara></listitem>
<listitem><simpara>
  <emphasis role="bold">не используя</emphasis> XFree86: попробуйте драйвера в следующем порядке:
<link linkend="vesa">vesa</link>,
<link linkend="fbdev">fbdev</link>,
<link linkend="svgalib">svgalib</link>,
<link linkend="aalib">aalib</link>.
  </simpara></listitem>
</itemizedlist>
</para>
</sect2>

<!-- FIXME: find a more logical organization for this section -->
<sect2 id="cirrus-logic-cards" xreflabel="Cirrus-Logic карты">
<title>Cirrus Logic карты</title>
<itemizedlist>
<listitem><para>
  GD 7548: установлено на материнской плате и тестировалась в ноутбуках серии
  Compaq Armada 41xx.
  <itemizedlist>
  <listitem><simpara>
    XFree86 3: работает в 8/16bpp режимах. Хотя, драйвер очень медленный и
    генерирует ошибки в режиме 800x600@16bpp.
    <emphasis role="bold">Рекомендуется: 640x480@16bpp</emphasis>
  </simpara></listitem>
  <listitem><simpara>
    XFree86 4: Xserver замораживается вскоре после старта, если акселерация
    не отключена, но тогда все становится медленнее, чем под XFree86 3.
    Нет XVideo.
  </simpara></listitem>
  <listitem><simpara>
    FBdev: фреймбуфер[framebuffer - кадровый буфер] может быть включён <option>clgenfb</option>
    драйвером в ядре, хотя для меня это работало только при 8bpp, и поэтому
    непригодно. В исходный код до компиляции должен быть добавлен 7584 ID
  </simpara></listitem>
  <listitem><simpara>
    VESA: карта совместима только с VBE 1.2, поэтому VESA вывод не может
    использоваться. Не может быть обойдено с UniVBE.
  </simpara></listitem>
  <listitem><simpara>
    SVGAlib: определяется как более старый Cirrus чип. Работает, но медленно с
    <option>-bpp 8</option>.
  </simpara></listitem>
</itemizedlist>
</para></listitem>
</itemizedlist>
</sect2>
</sect1>


<sect1 id="sound-cards">
<title>Звуковые карты:</title>

<itemizedlist>
<listitem><simpara>
  <emphasis role="bold">Soundblaster Live!</emphasis>: с этой картой Вы можете использовать 4 или 6 (<emphasis role="bold">5.1</emphasis>)
  канальное AC3 декодирование, вместо 2. Читайте секцию
  <link linkend="swac3">Программное AC3 декодирование</link>.
  Для аппаратного пропуска AC3[hardware AC3 passthrough] Вы
  <emphasis role="bold">должны</emphasis> использовать ALSA 0.9 с эмуляцией OSS!
  </simpara></listitem>
<listitem><simpara>
  <emphasis role="bold">C-Media с S/PDIF выходом</emphasis>: аппаратная AC3 передача[passthrough] возможна
  с этими картами, см. секцию <link linkend="hwac3">Аппаратное AC3
  декодирование</link>.
  </simpara></listitem>
<listitem><simpara>
  Возможности <emphasis role="bold">других карт</emphasis> не поддерживаются <application>MPlayer'ом</application>.
  Очень рекомендуется прочитать секцию <link linkend="audio">звуковые карты</link>!
  </simpara></listitem>
</itemizedlist>
</sect1>


<sect1 id="features">
<title>Возможности:</title>

<itemizedlist>
<listitem><para>
  Решите, нужен ли Вам GUI. Если да, прочитайте до компиляции
  секцию <link linkend="gui">GUI</link>.
  </para></listitem>
<listitem><para>
  Если Вы хотите установить <application>MEncoder</application> (наш великолепный многоцелевой кодировщик),
читайте <link linkend="mencoder">секцию <application>MEncoder</application></link>.
  </para></listitem>
<listitem><para>
  Если у Вас есть V4L совместимый <emphasis role="bold">TV тюнер</emphasis>, и Вы хотите смотреть/захватывать
и кодировать MPlayer'ом фильмы, читайте секцию <link linkend="tv-input">TV вход</link>.
  </para></listitem>
<listitem><para>
  Если у вас есть V4L совместимый <emphasis role="bold">Radio тюнер</emphasis>,
  и вы хотите слушать/записывать MPlayer'ом радиопередачи, читайте секцию 
  <link linkend="radio">Радио</link>.
  </para></listitem>
<listitem><para>
  Существует изящное <emphasis role="bold">OSD Меню</emphasis> готовое для использования. Проверьте секцию
<link linkend="subosd">OSD Меню</link>.
  </para></listitem>
</itemizedlist>

<para>
Теперь соберите <application>MPlayer</application>:
<screen>
./configure
make
make install</screen>
</para>

<para>
В этот момент, <application>MPlayer</application> готов к использованию. Каталог
<filename class="directory">$PREFIX/share/mplayer</filename> содержит файл <filename>codecs.conf</filename>,
который используется, чтобы сообщить программе обо всех кодеки и их возможности.
Этот файл требуется только в том случае, если Вы хотите поменять их настройки,
поскольку основной запускаемый файл содержит внутреннюю копию этого файла.
Проверьте, не содержится ли файл <filename>codecs.conf</filename> в Вашем домашнем каталоге
(<filename>~/.mplayer/codecs.conf</filename>) оставленный от предыдущих версий MPlayer'а,
и удалите его.
</para>


<para>
Обратите внимание на то, что если у Вас в <filename>~/.mplayer/</filename> есть 
файл <filename>codecs.conf</filename>, то встроенный и системный файлы
<filename>codecs.conf</filename> будут полностью игнорированы. Не делайте
этого, если только Вы не собираетесь развлекаться со внутренностями <application>MPlayer</application>'а,
поскольку это может вызвать множество проблем. Если Вы хотите поменять порядок
подбора кодеков, используйте опции <option>-vc</option>, <option>-ac</option>,
<option>-vfm</option>, и <option>-afm</option> либо в командной строке, либо
в Вашем конфигурационном файле (см. страницу руководства).
</para>


<para>
Пользователи Debian могут сами создать .deb пакеты, это очень
просто. Просто запустите <screen>fakeroot debian/rules binary</screen> в корневом
каталоге <application>MPlayer'а</application>. Более подробные инструкции см.
в разделе <link linkend="debian">Создание Debian пакетов</link>.
</para>


<para>
<emphasis role="bold">Всегда просматривайте вывод</emphasis> <filename>./configure</filename>, и файл
<filename>configure.log</filename>, они содержат информацию о том, что будет собрано,
а что нет. Возможно Вы захотите просмотреть файлы <filename>config.h</filename> и
<filename>config.mak</filename>.
Если у Вас стоят какие-то библиотеки, которые не определяются 
<filename>./configure</filename>, проверьте, что у Вас установлены соответствующие
заголовки[header files] (обычно это -dev пакеты) и их версии совпадают. Файл
<filename>configure.log</filename> Обычно сообщит Вам, чего не хватает для сборки.
</para>


<para>
Хотя это не обязательно, но чтобы получить функционирующие OSD и субтитры,
должны быть установлены шрифты. Рекомендуемый метод - установка TTF шрифта и
указание <application>MPlyer</application>'у использовать его. Подробности, см. в  секции
<link linkend="subosd">Субтитры и OSD</link>.
</para>

</sect1>

<!-- ********** -->

<sect1 id="gui">
<title>Как насчёт GUI?</title>

<para>
Для GUI требуется GTK 1.2.x или GTK 2.0 (он не целиком GTK'шный, но панельки - да). Шкуры хранятся
в PNG формате, поэтому GTK, <systemitem class="library">libpng</systemitem> (и их части для разработчиков, обычно они
называются <systemitem class="library">gtk-dev</systemitem> и <systemitem class="library">libpng-dev</systemitem>) должны быть установлены.
Вы можете собрать GUI, указав <option>--enable-gui</option> в <option>./configure</option>.
Затем, чтобы использовать GUI, Вы должны запускать <command>gmplayer</command>.
</para>

<para>
В настоящий момент, Вы не можете использовать опцию <option>-gui</option> в командной
строке, по техническим причинам.
</para>


<para>
Поскольку <application>MPlayer</application> не содержит ни одной шкуры, Вы должны скачать их, если Вы
хотите использовать GUI. См. 
<ulink url="http://www.mplayerhq.hu/dload.html">download page[страницу
закачек]</ulink>. Они должны быть извлечены в системный каталог
(<filename class="directory">$PREFIX/share/mplayer/skins</filename>), или в 
<filename class="directory">$HOME/.mplayer/skins</filename>. По умолчанию, MPlayer ищет каталог <filename class="directory">default</filename>
в этих каталогах, но вы можете использовать опцию <option>-skin <replaceable>newskin</replaceable></option>,
или директиву конфигурационного файла <option>skin=newskin</option>, чтобы использовать
шкуру из каталога <filename class="directory">*/skins/newskin</filename>.
</para>
</sect1>

<!-- ********** -->

<sect1 id="subosd">
<title>Субтитры и OSD</title>

<para>
Вместе с фильмом <application>MPlayer</application> может показывать и субтитры. В настоящий момент
поддерживаются следующие форматы:
<itemizedlist>
<listitem><para>VOBsub</para></listitem>
<listitem><para>OGM</para></listitem>
<listitem><para>CC (closed caption[скрытые титры])</para></listitem>
<listitem><para>MicroDVD</para></listitem>
<listitem><para>SubRip</para></listitem>
<listitem><para>SubViewer</para></listitem>
<listitem><para>Sami</para></listitem>
<listitem><para>VPlayer</para></listitem>
<listitem><para>RT</para></listitem>
<listitem><para>SSA</para></listitem>
<listitem><para>PJS (Phoenix Japanimation Society)</para></listitem>
<listitem><para><link linkend="mpsub">MPsub</link></para></listitem>
<listitem><para>AQTitle</para></listitem>
<listitem><para><ulink url="http://unicorn.us.com/jacosub/">JACOsub</ulink></para></listitem>
</itemizedlist>
</para>

<para>
<application>MPlayer</application> может конвертировать вышеперечисленные форматы субтитров (<emphasis role="bold">кроме первых
трёх</emphasis>) в следующие форматы с помощью соответствующих опций:
<itemizedlist>
<listitem><para>MPsub: <option>-dumpmpsub</option></para></listitem>
<listitem><para>SubRip: <option>-dumpsrtsub</option></para></listitem>
<listitem><para>MicroDVD: <option>-dumpmicrodvdsub</option></para></listitem>
<listitem><para>JACOsub: <option>-dumpjacosub</option></para></listitem>
<listitem><para>Sami: <option>-dumpsami</option></para></listitem>
</itemizedlist>
</para>

<para>
<application>MEncoder</application> может выдавать DVD субтитры в <link linkend="menc-feat-extractsub">VOBsub</link> формате.
</para>

<para>
Опции значительно различаются для различных форматов:
</para>

<formalpara>
<title>VOBsub субтитры</title>
<para>
VOBsub субтитры состоят из большого (несколько мегабайт) <filename>.SUB</filename> файла, и необязательных
<filename>.IDX</filename> и/или <filename>.IFO</filename> файлов.
Использование: если у Вас, например, есть файлы
<filename><replaceable>sample.sub</replaceable></filename>,
<filename><replaceable>sample.ifo</replaceable></filename> (необязательно), 
<filename><replaceable>sample.idx</replaceable></filename> - Вы должны указать
<application>MPlayer</application>'у опции <option>-vobsub sample [-vobsubid <replaceable>id</replaceable>]</option> (можно указать полный путь).
Опция <option>-vobsubid</option> похожа на <option>-sid</option>
для DVD, с её помощью, Вы можете выбирать между дорожками субтитров (языками).
В случае, если <option>-vobsubid</option> пропущена, MPlayer попытается использовать
языки, полученные через опцию <option>-slang</option> и перейти к пункту 
<systemitem>langidx</systemitem> в <filename>.IDX</filename> файле, чтобы выбрать язык субтитров. Если и это
не удаётся, то субтитров не будет.
</para>
</formalpara>

<formalpara>
<title>Другие субтитры</title>
<para>
Прочие форматы субтитров состоят из единого текстового файла, содержащего информацию
о синхронизации, местоположении и тексте субтитра.
Использование: Если у Вас есть, например, файл
<filename><replaceable>sample.txt</replaceable></filename>, 
Вы должны указать опцию <option>-sub <replaceable>sample.txt</replaceable></option>
(можно указать полный путь).
</para>
</formalpara>

<variablelist>
<title>Регулировка синхронизации и местоположения субтитров:</title>
<varlistentry>
  <term><option>-subdelay <replaceable>sec</replaceable></option></term>
  <listitem><simpara>
    Задерживает субтитры на <option><replaceable>sec</replaceable></option>
	секунд. Это значение может быть отрицательным.
    </simpara></listitem>
</varlistentry>
<varlistentry>
  <term><option>-subfps <replaceable>RATE</replaceable></option></term>
  <listitem><simpara>
    Указывает количество кадров/сек для файла субтитров (вещественное число)
    </simpara></listitem>
</varlistentry>
<varlistentry>
  <term><option>-subpos <replaceable>0-100</replaceable></option></term>
  <listitem><simpara>
    Указывает позицию субтитров.
    </simpara></listitem>
</varlistentry>
</variablelist>

<para>
Если Вы наблюдаете увеличивающуюся задержку между фильмом и субтитрами, используя
файл субтитров в формате MicroDVD, наиболее вероятно, что частота кадров у фильма и файла
субтитров не совпадают. Пожалуйста, обратите внимание, что формат MicroDVD
использует абсолютные номера кадров для синхронизации, но в нем нет информациио частоте кадров 
и поэтому опция
<option>-subfps</option> не может использоваться с этим форматом. 
Вы должны, если хотите навсегда решить эту проблему, вручную конвертировать
частоту кадров файла субтитров.
<application>MPlayer</application> может сделать для вас это преобразование: 
<screen>mplayer -dumpmicrodvdsub -fps <replaceable>subtitles_fps</replaceable> -subfps <replaceable>avi_fps</replaceable> -sub <replaceable>subtitle_filename</replaceable> <replaceable>dummy.avi</replaceable></screen>
</para>

<para>
О DVD субтитрах, читайте в секции <link linkend="dvd">DVD</link>.
</para>


<sect2 id="mpsub">
<title>Собственный формат субтитров <application>MPlayer</application>'а (MPsub)</title>

<para>
<application>MPlayer</application> ввёл в употребление новый формат субтитров,
называемый <emphasis role="bold">MPsub</emphasis>. Он был
разработан Gabucino. По существу, его основная особенность - это
использование <emphasis>динамической</emphasis> временной привязки (хотя существует и режим
покадровой привязки). Пример (из 
<ulink url="../../tech/mpsub.sub">DOCS/tech/mpsub.sub</ulink>):
<programlisting>
FORMAT=TIME
# первый номер : столько  прождать после того, как исчез предыдущий субтитр
# второй номер : столько секунд показывать текущий субтитр

15 3
A long long, time ago...

0 3
in a galaxy far away...

0 3
Naboo was under an attack.<!--
--></programlisting>
</para>

<para>
Как видите, основной целью было <emphasis role="bold">сделать простым редактирование/синхронизацию/
объединение/разрезание простым</emphasis>. И, если Вы, например, получили SSA
субтитры но они плохо синхронизированы с Вашей версией фильма,
Вы просто запускаете
<screen>mplayer <replaceable>dummy.avi</replaceable> -sub source.ssa -dumpmpsub</screen>.
В текущем каталоге будет создан файл <filename>dump.mpsub</filename>, содержащий
исходный текст субтитров, но в <emphasis role="bold">MPsub</emphasis> формате. После этого, Вы можете
свободно добавлять/вычитать секунды к/от субтитра.
</para>

<para>
Субтитры выводятся, используя технику <emphasis role="bold">'OSD', On Screen
Display</emphasis>.  OSD используется для вывода текущего времени, полос громкости и
перемещения, и т. п.
</para>
</sect2>


<sect2 id="mpsub-install">
<title>Установка OSD и субтитров</title>

<para>
Чтобы использовать возможности OSD/SUB, Вам нужен пакет шрифтов <application>MPlayer</application>'а.
Есть много способов их получить:
</para>

<itemizedlist>
<listitem><para>
    используйте TrueType (TTF) шрифт, через библиотеку <emphasis role="bold">freetype</emphasis>.
    Обязательна версия 2.0.9 или выше! Тогда у Вас есть два метода:
  <itemizedlist>
    <listitem><para>
	  используйте опцию <option>-font <replaceable>/path/to/sample_font.ttf</replaceable></option>,
	  чтобы указывать каждый раз путь к TrueType шрифту
      </para></listitem>
    <listitem><para>
	  создайте ссылку:
      <screen>ln -s <replaceable>/path/to/sample_font.ttf</replaceable> ~/.mplayer/subfont.ttf</screen>
      </para></listitem>
      </itemizedlist>
  Если <application>MPlayer</application> был скомпилирован с поддержкой 
  <systemitem class="library">fontconfig</systemitem>, эти методы не будут работать,
  вместо этого, опция <option>-font</option> ожидает
  <systemitem class="library">fontconfig</systemitem>'овское название
  шрифта, и по умолчанию это фонт без засечек (sans-serif). Чтобы получить список
  шрифтов известных <systemitem class="library">fontconfig</systemitem>'у,
  используйте <command>fc-list</command>.
  Пример: <option>-font <replaceable>'Bitstream Vera Sans'</replaceable></option>
  </para></listitem>
<listitem><para>
  Скачать готовый к употреблению пакет шрифтов с сайта MPlayer'а.
  Замечание: Доступные в настоящий момент шрифты ограничены до поддержки
  ISO 8859-1/2, но существуют другие (включая корейские, русские, ISO 8859-8
  и др.) сделанные пользователями шрифты в contrib/font секции FTP.
  </para><para>
  <!-- FIXME: this para should be before the list -->
  Шрифт должен содержать соответствующий <filename>font.desc</filename> файл,
  который создаёт соответствия между Unicode позицией в шрифте и кодовой
  страницей субтитра. Другим решением является наличие субтитра в UTF-8 кодировке
  и использование опции <option>-utf8</option>, или просто обозвать файл
  субтитра <filename>&lt;video_name&gt;.utf</filename> и разместить его
  в каталоге с фильмом. Перекодировка из различных кодировок в UTF-8 может быть
  осуществлена с помощью программ <command>konwert</command> или <command>iconv</command>.
  </para><para>
  
  <table>
  <title>Некоторые URL'ы</title>
  <tgroup cols="2">
  <thead>
    <row><entry>URL</entry><entry>Comment</entry></row>
  </thead>
  <tbody>
  <row><entry>
    <ulink url="ftp://ftp.mplayerhq.hu/MPlayer/releases/fonts/"></ulink>
    </entry><entry>
    ISO шрифты
    </entry></row>
  <row><entry>
    <ulink url="ftp://ftp.mplayerhq.hu/MPlayer/contrib/fonts/"></ulink>
    </entry><entry>
    различные шрифты, сделанные пользователями
    </entry></row>
  </tbody>
  </tgroup>
  </table>
  </para></listitem>
</itemizedlist>
<para>
Если Вы решите использовать не-TTF шрифты, UNZIP'ните скаченный файл в
<filename class="directory">~/.mplayer</filename> или <filename
class="directory">$PREFIX/share/mplayer</filename>. Затем переименуйте,
или создайте символическую ссылку на один из каталогов в
<filename class="directory">font</filename> (напр.:

<screen>ln -s <replaceable>~/.mplayer/arial-24</replaceable> ~/.mplayer/font</screen>).
Теперь Вы должны увидеть таймер в левом верхнем углу фильма (выключите его кнопкой <keycap>o</keycap>).
</para>

<para>
(субтитры <emphasis>всегда включены</emphasis>, чтобы узнать, как их отключить,
читайте страницу man)
</para>

<para>
У OSD 4 состояния: (переключаются кнопкой <keycap>o</keycap>):

<orderedlist>
<listitem><simpara>
  полосы громкости + перемещения (по умолчанию)
  </simpara></listitem>
<listitem><simpara>
  полосы громкости + перемещения + таймер + позиция в файле в процентах при перемещении
  </simpara></listitem>
<listitem><simpara>
  полосы громкости + перемещения + таймер + длина всего фильма
  </simpara></listitem>
<listitem><simpara>
  только субтитры
  </simpara></listitem>
</orderedlist>

Вы можете изменить действия по умолчанию, установив в нужное значение переменную
<option>osdlevel</option> в конфигурационном файле, или используя опцию
<option>-osdlevel</option> командной строки.

</para>
</sect2>


<sect2 id="osdmenu">
<title>OSD меню</title>

<para>
У <application>MPlayer</application>'а существует целиком определяемый пользователем интерфейс OSD меню.
</para>

<note><simpara>
меню Preferences[Настройки] в настоящий момент НЕ НАПИСАНО!
</simpara></note>

<orderedlist>
<title>Установка</title>
<listitem><simpara>
  скомпилируйте <application>MPlayer</application>, указав <filename>
  ./configure</filename> параметр <option>--enable-menu</option>
  </simpara></listitem>
<listitem><simpara>
  убедитесь, что у Вас установлен OSD шрифт
  </simpara></listitem>
<listitem><simpara>
  скопируйте <filename>etc/menu.conf</filename> в Ваш каталог <filename
  class="directory">.mplayer</filename>
  </simpara></listitem>
<listitem><simpara>
  скопируйте <filename>etc/input.conf</filename> в Ваш каталог <filename
  class="directory">.mplayer</filename>, или в системный конфигурационный
  каталог <application>MPlayer</application>'а (по умолчанию: 
  <filename class="directory">/usr/local/etc/mplayer</filename>)
   </simpara></listitem>
<listitem><simpara>
  проверьте и отредактируйте <filename>input.conf</filename>, чтобы включить
  кнопки перемещения по меню (это здесь описано).
  </simpara></listitem>
<listitem><para>
  запустите <application>MPlayer</application> как в следующем примере:
  <screen>$ mplayer -menu <replaceable>file.avi</replaceable></screen>
  </para></listitem>
<listitem><simpara>
  нажмите любую меню-кнопку, которую Вы определили
  </simpara></listitem>
</orderedlist>

</sect2>
</sect1>

<!-- ********** -->

<sect1 id="rtc">
<title>RTC</title>
<para>
У <application>MPlayer</application>'а есть три метода синхронизации.

<itemizedlist>
<listitem><simpara>
<emphasis role="bold">Чтобы использовать старый метод синхронизации</emphasis>,
  Вам ничего не надо делать. Он использует <systemitem>usleep()</systemitem>,
  чтобы подстроить A/V синхронизацию, с точностью +/- 10ms. Однако, иногда
  требуется даже большая точность синхронизации.
  </simpara></listitem>
<listitem><para>
<emphasis role="bold">Новый таймер</emphasis> использует RTC (Real Time
  Clock[часы истинного времени]) для этой задачи потому, что это таймер
  точностью 1ms. Он включается опцией <option>-rtc</option>, но требует
  правильно настроенного ядра.
  Если Вы работаете с ядром 2.4.19pre8 или более поздним, Вы можете настроить
  максимальную частоту RTC для обычных пользователей через файловую систему
  <systemitem class="systemname">/proc</systemitem>.
  Используйте эту команду, чтобы сделать RTC доступным для обычных
  пользователей:
  <screen>echo 1024 &gt; /proc/sys/dev/rtc/max-user-freq</screen>
   Вы увидите эффективность нового кода таймера по строке состояния.
   Функции управления потребляемой мощностью[power management] у некоторых
   ноутбуковских BIOS'ов со speedstep-CPU плохо взаимодействуют с RTC. Аудио и
   видео могут десинхронизироваться. Вероятно, если Вы вставите штекер внешнего
   питания до включения ноутбука, то это поможет. В некоторых аппаратных
   комбинациях (подтверждено при использовании не-DMA DVD драйва с материнской
   платой ALi1541) использование RTC таймера приводит к "прыгающему"[skippy]
   проигрыванию. В этом случае рекомендуется использовать третий метод.
  </para></listitem>
<listitem><simpara>
  <emphasis role="bold">Третий код таймера</emphasis> включается опцией
  <option>-softsleep</option>. У него эффективность RTC, но он не использует
  RTC. С другой стороны, он сильнее использует CPU.
  </simpara></listitem>
</itemizedlist>
</para>
</sect1>
</chapter>
